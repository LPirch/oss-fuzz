#!/bin/bash -eu

targets="$@"
project="$(basename $(pwd))"

for f in $(find "${OUT}" -type f -name "*.json"); do
        ast_file="$f"
        f="${f#$OUT/$project/}"
        d="$(dirname $f)"
        stem="$(basename $f)"
        stem="${stem#AST_}"
        stem="${stem%.c.json}"
        if ! (printf '%s\n' "${targets[@]}" | grep -- "$d/$stem.o" &>/dev/null); then
                if [ -f "${ast_file}" ]; then
                        rm "${ast_file}"
                fi
        fi
done